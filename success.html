<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Successful - Plara</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .success-container {
            max-width: 600px;
            margin: 80px auto;
            text-align: center;
            padding: var(--spacing-2xl);
        }

        .success-icon {
            font-size: 5rem;
            margin-bottom: var(--spacing-xl);
            animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes scaleIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .success-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            color: var(--color-text-primary);
        }

        .success-message {
            font-size: 1.25rem;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-2xl);
            line-height: 1.6;
        }

        .order-details {
            background: var(--color-bg-subtle);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin: var(--spacing-2xl) 0;
            text-align: left;
        }

        .order-details h3 {
            margin-bottom: var(--spacing-md);
            color: var(--color-text-primary);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--color-border);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: var(--color-text-secondary);
        }

        .detail-value {
            font-weight: 600;
            color: var(--color-text-primary);
        }

        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            margin-top: var(--spacing-2xl);
            flex-wrap: wrap;
        }

        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
            height: 20px;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--color-border);
            border-top-color: var(--color-accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: var(--spacing-xl) auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .success-container {
                margin: 40px auto;
                padding: var(--spacing-lg);
            }

            .success-title {
                font-size: 2rem;
            }

            .success-message {
                font-size: 1.1rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn-signin {
                width: 100%;
            }
        }
    </style>
</head>

<body>

    <!-- Top Navbar -->
    <nav class="top-navbar">
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        <a href="index.html" class="logo">
            <span class="logo-dots">‚Åù</span>
            <span class="logo-text-main">Plara</span>
        </a>
    </nav>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="help.html" class="nav-link">Help</a></li>
                <li><a href="pricing.html" class="nav-link">Pricing</a></li>
                <li><a href="features.html" class="nav-link">ü§ñ Features</a></li>
            </ul>
        </nav>
        <div class="sidebar-footer">
            <div class="auth-section">
                <span class="auth-status">Not signed in</span>
                <button class="btn-signin" id="signinBtn">Sign in</button>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="success-container">
            <div class="success-icon">‚úÖ</div>
            <h1 class="success-title">Payment Successful!</h1>
            <p class="success-message">
                Thank you for your purchase. Your payment has been processed successfully.
            </p>

            <!-- Order Details -->
            <div class="order-details" id="orderDetails">
                <h3>Order Details</h3>
                <div id="detailsContent">
                    <div class="spinner"></div>
                    <p style="text-align: center; margin-top: var(--spacing-md); color: var(--color-text-secondary);">
                        Loading order details...
                    </p>
                </div>
            </div>

            <!-- Confirmation Message -->
            <div style="background: #e6f7ff; border: 1px solid #91d5ff; border-radius: var(--radius-md); padding: var(--spacing-lg); margin: var(--spacing-xl) 0;">
                <p style="color: #0050b3; margin: 0;">
                    üìß A confirmation email has been sent to your inbox with your order details and receipt.
                </p>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <a href="index.html" class="btn-signin">Go to Dashboard</a>
                <a href="help.html" class="btn-signin" style="background: var(--color-bg-subtle); color: var(--color-text-primary); border: 1px solid var(--color-border);">
                    Get Support
                </a>
            </div>
        </div>
    </main>

    <script src="app.js"></script>
    <script type="module">
        import { PolarCheckout } from './src/polar-checkout.js';

        // Initialize Polar
        const polar = new PolarCheckout({ apiBase: '/api' });

        // Get checkout ID from URL
        const checkoutId = PolarCheckout.getCheckoutIdFromURL();

        async function loadOrderDetails() {
            if (!checkoutId) {
                document.getElementById('detailsContent').innerHTML = `
                    <p style="color: var(--color-text-secondary); text-align: center;">
                        No order information available.
                    </p>
                `;
                return;
            }

            try {
                // Verify checkout with backend
                const checkout = await polar.verifyCheckout(checkoutId);

                // Display order details
                document.getElementById('detailsContent').innerHTML = `
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span>
                        <span class="detail-value">${checkout.checkout_id.substring(0, 16)}...</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Product:</span>
                        <span class="detail-value">${checkout.product_name || 'Plara Subscription'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Amount Paid:</span>
                        <span class="detail-value">${polar.formatPrice(checkout.amount, checkout.currency)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Status:</span>
                        <span class="detail-value" style="color: var(--color-success);">‚úì Confirmed</span>
                    </div>
                    ${checkout.customer_email ? `
                    <div class="detail-row">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value">${checkout.customer_email}</span>
                    </div>
                    ` : ''}
                    <div class="detail-row">
                        <span class="detail-label">Date:</span>
                        <span class="detail-value">${new Date(checkout.created_at).toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}</span>
                    </div>
                `;

                // Clear session storage
                sessionStorage.removeItem('polar_checkout_id');
                sessionStorage.removeItem('polar_product_id');

            } catch (error) {
                console.error('Error loading order details:', error);
                document.getElementById('detailsContent').innerHTML = `
                    <p style="color: var(--color-error); text-align: center;">
                        Unable to load order details. Please check your email for confirmation.
                    </p>
                `;
            }
        }

        // Load order details on page load
        document.addEventListener('DOMContentLoaded', loadOrderDetails);
    </script>
</body>

</html>
